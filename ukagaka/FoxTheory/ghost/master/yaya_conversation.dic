/*
OnTranslate{
  //reference[2]がイベント名
  //reference[0]が話した内容
  if (reference[2] == "OnAITalk"){
    UsedAITalk = SHIORI3FW.RemoveAllTags_text(reference[0])
    //SHIORI3FW.LastAITalkでも取得できるはずだけどまあいいや

  }
  if (reference[2] == "OnCommu"){
    UsedCommunicate = (UsedCommunicate, SHIORI3FW.RemoveAllTags_text(reference[0])
  }
*/
Conversation_Begin{
  //ここでcommu配列は初期化
  //UsedCommunicate = IARRAY
  '\![open,inputbox,OnConversation,60000,--option=noclose]'
}
OnConversation{
  //Morph_Juman3に文章を渡すと解析結果の形態素;よみ;基本形;品詞;詳細品詞;意味を返す
  //このままだと意味が連結されてる。なんとか分けたい
  //各形態素は改行で区切られている
  //reference0が入力された文
  reference0 = HAN2ZEN(reference0)//jumanは全角を想定
  _morpharray = SPLIT(Morph_Juman3(reference0), "\n")
  _morpharray_size = ARRAYSIZE(_morpharray)
  //_usedcommunicate_size = ARRAYSIZE(UsedCommunicate)

  //指示代名詞のチェック
  //最後に入力したcommu→そのまえ→最後のAItalkで判定 AITalkにタグみたいなのがあれば……
  //jumanでは指示詞。+さっき　で判定？
  /*
  for _i = 0; _i < _morpharray_size; _i++{//複数あったらランダムで選ばれる
    if (_morpharray[_i][0,";"] == "さっき"){

    }
    if (_morpharray[_i][4,";"] == "連体詞形態指示詞"){//あの、この
      UsedCommunicate[_usedcommunicate_size-1]
    }
    if (_morpharray[_i][4,";"] == "副詞形態指示詞"){//どう、こう

    }
    if (_morpharray[_i][4,";"] == "名詞形態指示詞")//あれ、これ
  }
  */

  //形態素解析→単語を配列とチェック
  //意味チェック
  //汎用配列でジャンルごとに各配列を作成
  //commu = (A,B,C)
  //出力候補が複数あるときはその中からランダムに選ばれる
  //カテゴリー→ドメインとするべき。
  //重要なのはif (カテゴリ&&ドメイン)で判定
  //そうでないのはカテゴリーだけで判定
  //ドメインだけで判定するものもありそう。たとえばレクリエーションとか
  /*
  以下ドメイン
  "文化・芸術"//映画、音楽
  "レクリエーション"//観光、花火、カジノ
  "スポーツ"
  "健康・医学"
  "家庭・暮らし"
  "料理・食事"
  "交通"//駅、道路、アクセル…
  "教育・学習"
  "科学・技術"
  "ビジネス"
  "メディア"
  "政治"
  */
  for _i = 0; _i < _morpharray_size; _i++{
    //人工物-食べ物開始
    //飲み物も含まれるのでなんとかしたいところ
    if (RE_SEARCH(_morpharray[_i][5,";"], "人工物-食べ物,") && RE_SEARCH(_morpharray[_i][5,";"], "料理・食事," )){
      if (RE_SEARCH(morpharray[_i],"食事|食べる") == 0){
        <<"
        リサ０１：それが好きなの？
        リサ６５：確かに、%(_morpharray[_i][2,";"])って結構おいしいよね。
        ">>

        <<"
        リサ０１：%(_morpharray[_i][2,";"])……
        リサ０５：最近、マーケットで見かけた気がする。買ってこようか？
        ">>
      }

      <<"
      リサ０７：そういえば、お腹がすいてきたかも……
      リサ０１：%(username)、一緒に食べにいかない？
      ">>

      <<"
      リサ６７：そういえば、%(usename)は料理は得意？
      ">>
    }
    elseif (RE_SEARCH(_morpharray[_i][5,";"], "人工物-食べ物,")){
      <<"
      リサ６７：……それって、おいしいの？
      ">>

      <<"
      リサ６７：そんな料理は聞いたことがない……
      リサ０１：今度、教えてくれる？
      ">>

      <<"
      リサ６７：%(_morpharray[_i][2,";"])？
      リサ６７：……ってどこの料理？
      ">>
    }
    //人工物-食べ物終了

    //人工物-衣類開始
    if (RE_SEARCH(_morpharray[_i][5,";"], "人工物-衣類,")){
      if (RE_SEARCH(reference0, "格好いい|かっこいい|カッコいい|かわいい|可愛い")){
        <<"
        リサ３７：……
        リサ５２：あ、ありがとう。
        ">>

        <<"
        リサ２２：けっこう気に入ってるよ、ありがとう。
        ">>
      }
      <<"
      リサ６７：そういえば、知り合いに%(_morpharray[_i][2,";"])に詳しい人がいるんだけど。
      リサ０２：実は私の持ってる服のいくつかは、その人に仕立ててもらっているんだよ。
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "人工物-その他,") && RE_SEARCH(_morpharray[_i][5,";"], "料理・食事,")){
      <<"
      リサ００：食器がどうしたの？
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "人,")){
      //"人についてだね"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "組織・団体,")){
      <<"
      リサ６７：それは何かの団体？
      ">>

      <<"
      リサ６７：その組織には詳しくはないな……
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "動物-部位,")){
      //手、足……

      /*いわゆるセクハラ判定。セクハラっぽい動詞の基本形で判定。解析結果は基本形も出力してるのでOK*/
      /*あとはセクハラキーワードつかうか*/
      if (RE_ASEARCH("揉む|舐める|咥える|捲る|小さい|平坦だ|平らだ",Morph_Juman_Original(reference0)) != -1){
        <<"
        リサ２４：……
        ">>

        <<"
        リサ２４：……
        リサ３１：Pervert.
        ">>

        <<"
        リサ２４：……
        リサ３１：変態。
        ">>

        <<"
        リサ５３：……
        リサ５３：何言ってるの、まったく……
        ">>
        Conversation_Sexual = 1
      }
      if (((_morpharray[_i][2,";"] == "胸") || (_morpharray[_i][2,";"] == "おっぱい")) && RE_ASEARCH("触る|揉む|舐める|咥える|捲る|小さい|平坦だ|平らだ",Morph_Juman_Original(reference0))){
        <<"
        リサ２４：……
        ">>

        <<"
        リサ２４：……
        リサ３１：Pervert.
        ">>

        <<"
        リサ２４：……
        リサ３１：変態。
        ">>

        <<"
        リサ５３：……
        リサ５３：何言ってるの、まったく……
        ">>
        Conversation_Bust = 1
        Conversation_Sexual = 1
      }
      if (RE_SEARCH(reference0, "格好いい|かっこいい|カッコいい|かわいい|可愛い")){
        <<"
        リサ３７：……
        リサ５２：あ、ありがとう。
        ">>
      }
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "植物-部位,")){
      //葉、根……
      //"植物の組織についてだね"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "動物,")){
      <<"
      リサ０１：%(_morpharray[_i][2,";"])？かわいいよね。
      ">>

      <<"
      リサ０１：動物は私も結構好きだよ。
      ">>

      <<"
      リサ０１：%(_morpharray[_i][2,";"])か、動物って観察してみると意外な発見があったりするよね。
      ">>
      /*
      if (RE_SEARCH(_morpharray[_i][5,";"], "狐|きつね|キツネ"){
        <<"
        リサ０１：一応、私も"
      }
      */
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "植物,")){
      <<"
      リサ０５：%(_morpharray[_i][2,";"])……
      リサ００：前公園で見たような……
      ">>

      <<"
      リサ０５：植物のエネルギー効率はなかなか侮れないよね。
      リサ０１：実は、太陽電池よりもはるかに効率がいいんだよ。
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "自然物,")){
      //石、岩……
      //"自然についてだね"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "場所-施設部位,")){
      //天井、床……
      //"施設部位についてだね"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "場所-施設,")){
      //ビル、公園……
      <<"
      リサ６７：出かけるの？%(username)。
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "場所-自然,")){
      //山、川……
      <<"
      リサ０１：%(_morpharray[_i][2,";"])か、私もどこかに出かけようかな……
      ">>

      <<"
      リサ０１：たまには外に出てみるのもいいかもね。
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "場所-機能,")){
      //上、下……
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "場所-その他,")){
      //"場所、その他"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "抽象物," ) && RE_SEARCH(_morpharray[_i][5,";"], "教育・学習,")){
      //抽象物
      <<"
      リサ０１：今度それについて教えてくれないかな？
      リサ０２：私も勉強したいんだ。
      ">>

      <<"
      リサ６７：%(_morpharray[_i][2,";"])の勉強？
      ">>

      <<"
      リサ０１：%(_morpharray[_i][2,";"])について勉強してるの？
      ">>

      <<"
      リサ０１：それについての本なら、書庫にあったと思うよ。
      リサ０１：取ってこようか？
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "形・模様,")){
      //"形について"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "色,")){
      //"色"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "数量,")){
      //"数量"
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "時間,")){
      <<"
      リサ６７：%(_morpharray[_i][2,";"])？
      リサ２００：……そういえば、時間のNoeterカレントとしてエントロピーを定義もできるんだよね。
      ">>

      <<"
      リサ０５：%(usename)の%(_morpharray[_i][2,";"])の予定は？
      ">>

      <<"
      リサ０５：%(_morpharray[_i][2,";"])の予定はどうしようかな……
      ">>

    }
    //以下ドメイン///////////
    /*普通はカテゴリーを優先するが、ドメインで十分な場合はこっちも
    むしろドメインの方がわかりやすいんじゃ*/
    if (RE_SEARCH(_morpharray[_i][5,";"], "文化・芸術,")){
      //映画、音楽
      <<"
      リサ０１：いい趣味をしているね。
      ">>

      <<"
      リサ０１：%(_morpharray[_i][2,";"])か……いいね。結構好きだよ。
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "レクリエーション,")){
      //観光、花火、カジノ
      <<"
      リサ０１：たまには遊ぶのもいいかもね、%(usename)。
      ">>

      <<"
      リサ０５：んー……、どうしようかな……
      ">>

      <<"
      リサ０１：%(_morpharray[_i][2,";"])？気分転換にはなるかもね。
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "スポーツ,")){
      <<"
      リサ０３：実は運動はあまり得意じゃないんだよね……
      ">>

      <<"
      リサ０１：んー……、どうしようかな……
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "健康・医学,")){
      <<"
      リサ６７：%(_morpharray[_i][2,";"])？もしかして、医学書とか探してる？あいにく手元にはないんだけど……
      ">>

      <<"
      リサ００：健康は大切だよね、本当に。%(usename)も体には気を付けてね？
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "家庭・暮らし,")){
      //うーむ
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "料理・食事,")){
      if (RE_SEARCH(_morpharray[_i], "食べる|食事") == 0){

        <<"
        リサ０１：それが好きなの？
        リサ６５：確かに、%(_morpharray[_i][2,";"])って結構おいしいよね。
        ">>

        <<"
        リサ０５：%(_morpharray[_i][2,";"])……
        リサ０５：最近、マーケットで見かけた気がする。
        リサ０１：買ってこようか？
        ">>
      }
      <<"
      リサ０５：(お腹すいたな……)
      ">>

      <<"
      リサ０５：私も何か食べようかな……
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "交通,")){
      //駅、道路、アクセル……
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "教育・学習,")){
      <<"
      リサ０５：私も勉強しようかな……
      ">>

      <<"
      リサ０１：何か勉強でもしてるの？
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "科学・技術,")){
      <<"
      リサ０１：%(_morpharray[_i][2,";"])か、いい技術だよね。
      ">>

      <<"
      リサ０１：私も%(_morpharray[_i][2,";"])について勉強しようかな……
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "ビジネス,")){
      <<"
      リサ６７：仕事のことかな？
      リサ０１：頑張ってね。
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "メディア,")){
      <<"
      リサ６７：%(_morpharray[_i][2,";"])？ニュースでも見てるの？
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "政治,")){
      <<"
      リサ０５：政治の話は……あんまり興味はないな……
      ">>
    }

    //Otherジャンル//////
    if (RE_SEARCH(_morpharray[_i][5,";"], "地名:国,")){
      <<"
      リサ００：%(_morpharray[_i][2,";"])？
      リサ０２：ああ、昔行ったことがあるよ。%(username)も行ったことあるの？
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "人名:外国,")){
      <<"
      リサ００：%(_morpharray[_i][2,";"])……？
      リサ０５：もしかして、あの%(_morpharray[_i][2,";"])のこと？
      リサ１９９：確かこの本にも記述があったような……
      ">>
    }
    if (RE_SEARCH(_morpharray[_i][5,";"], "人名:日本,")){
      <<"
      リサ００：%(_morpharray[_i][2,";"])……？
      リサ０５：もしかして、あの%(_morpharray[_i][2,";"])のこと？
      リサ１９９：確かこの本にも記述があったような……
      ">>
    }

    //wikipedia情報//////
    //これにヒットした場合は最優先の方が良いかも。重要な意味の形態素の可能性が高い
    if (RE_SEARCH(_morpharray[_i][5,";"], "Wikiリダイレクト|Wiki上位語")){
      if (_morpharray[_i][5,";"][1,"Wikiリダイレクト:"][0,"Wiki上位語"]){
        //リダイレクトにヒットした場合
        //その内容で再びjumanにかけるといいかも←そうでもなかった
        _redirect = Morph_Juman3(_morpharray[_i][5,";"][1,"Wikiリダイレクト:"][0,"Wiki上位語:"])
        <<"
        リサ６７：%(_morpharray[_i][2,";"])？
        リサ６７：%(_morpharray[_i][5,";"][1,"Wikiリダイレクト:"][0,"Wiki上位語:"][0," 代表表記"])のこと？
        ">>
      }
      if (_morpharray[_i][5,";"][1,"Wiki上位語:"]){
        //上位語にヒットした場合
        //上位語については注意が必要。単位/たんい　代表表記:ニュートン/ニュートンとか 読み不明とか
        /*いわゆるセクハラ。形態素としては
        家庭・暮らしドメイン
        Wiki上位語:行為で判定？
        部位(性器、胸)はカテゴリー：動物・部位が多い*/
        if (RE_SEARCH(_morpharray[_i][5,";"][1,"Wiki上位語:"],"行為")){
          <<"
          リサ２４:……
          ">>

          <<"
          リサ２４：……
          リサ３１：Pervert.
          ">>

          <<"
          リサ２４：……
          リサ３１：変態。
          ">>

          <<"
          リサ５３：……
          リサ５３：何言ってるの、まったく……
          ">>

          <<"
          リサ２４：何言ってるの？
          ">>
          Conversation_Sexual = 1
        }
        <<"
        リサ０５：それは……%(_morpharray[_i][5,";"][1,"Wiki上位語:"][0,"/"][0," 読み不明"])だっけ？
        ">>
      }

    }
  }
  //ここから具体的な配列で判定系…のつもりだったが旧式モジュールでとりあえずやっておく
  Conversation_old(reference0)//旧式の会話モジュール。一応入れておく
  _meaning = ""
  for _i = 0; _i < _morpharray_size; _i++{
    _meaning = _meaning + _morpharray[_i][5,";"]+"\n"
  }
  --
  <<"
  \1%(_meaning)
  ">>
  /*
  --
  '\![open,inputbox,OnConversation,60000,--option=noclose]'
  */
  --
  <<"
  \![timerraise,30000,1,OnConversation_FlagInit]
  ">>
}

//よく入力されそうなのはこちらで配列を用意しておく。
//あまりスマートじゃないけど……
//基本形を入れておく。形態素解析後の基本形で判定
Commusweets{
  "アプリコット"
  "苺"
  "ケーキ"
  "クッキー"
  "チョコレート"
  "シュークリーム"
  "ザッハトルテ"
  "モンブラン"
  "フロマージュ"
  "カスタード"
  "キャンディ"
}
Commulike{
  "好き"
  "好く"
  "愛す"
  "可愛い"
}
Commutired{
  "疲れる"
  "眠い"
}
CommuOK{
  "良い"
  "いい"
  "OK"
  "勿論"
  "了解"
}

AfterPronoun{
  //指示代名詞があった場合の反応
  //1,2,3が連体詞、副詞、名詞

}
